@model IEnumerable<_4PsPH.Models.Ticket>

@{
    ViewBag.Title = "Reports";

    var options = new List<SelectListItem>();
    options.Add(new SelectListItem { Text = "Yes", Value = "true" });
    options.Add(new SelectListItem { Text = "No", Value = "false" });
}

<div class="row">
    <div class="col-md-10 left-ui">
        <a href="@Url.Action("Index")" class="outside-link">« Back to List</a>
    </div>
</div>

<hr class="heading-cut" />

<div class="row">
    <div class="col-md-12" style="padding:0px;">
        <div class="col-xs-6">
            <div class="shadow-wrapper">
                <div class="row">
                    <div class="window-heading">
                        <div class="col-md-12">
                            <div class="links">
                                <strong>
                                    Ticket - Monthly Reports
                                </strong>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="window">
                        <div class="col-md-12">
                            <div class="form-group">
                                <label>Select Year:</label>

                                <select class="form-control" id="select-month-year" required>
                                    @foreach (var x in Model.GroupBy(m => m.DateTimeCreated.Year))
                                    {
                                        <option value="@x.Key">@x.Key</option>
                                    }
                                </select>
                            </div>

                            @foreach (var x in Model.GroupBy(m => m.DateTimeCreated.Year))
                            {
                                <div class="form-group select-month collapse" data-id="@x.Key">
                                    <label>Select Month:</label>

                                    <select class="form-control select-month-month">
                                        @foreach (var y in x.GroupBy(n => n.DateTimeCreated.Month))
                                        {
                                            <option value="@y.Key">@System.Globalization.CultureInfo.CurrentCulture.DateTimeFormat.GetMonthName(y.Key)</option>
                                        }
                                    </select>
                                </div>
                            }

                            @using (Ajax.BeginForm("GenerateReportMonth", null, new AjaxOptions
                            {
                                UpdateTargetId = "test",
                                InsertionMode = InsertionMode.Replace,
                                OnSuccess = "getSuccessMonth"
                            }, new { id = "month-form" }))
                            {
                                <input id="form_month_year" name="form_month_year" type="hidden"/>
                                <input id="form_month_month" name="form_month_month" type="hidden"/>
                            }
                        </div>
                    </div>
                </div>
                <div class="window-footer window-footer-btn">
                    <div class="col-md-12" style="text-align:right;">
                        <button class="btn btn-primary" type="submit" form="month-form">Generate</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xs-6">
            <div class="shadow-wrapper">
                <div class="row">
                    <div class="window-heading">
                        <div class="col-md-12">
                            <div class="links">
                                <strong>
                                    Ticket - Annual Reports
                                </strong>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="window">
                        <div class="col-md-12">
                            <div class="form-group">
                                <label>Select Year:</label>

                                @using (Ajax.BeginForm("GenerateReportYear", null, new AjaxOptions
                                {
                                    UpdateTargetId = "test",
                                    InsertionMode = InsertionMode.Replace,
                                    OnSuccess = "getSuccessYear"
                                }, new { id = "year-form" }))
                                {
                                    <div class="form-group">
                                        <select class="form-control" id="select_annual" name="select_annual">
                                            @foreach (var x in Model.GroupBy(m => m.DateTimeCreated.Year))
                                            {
                                                <option value="@x.Key">@x.Key</option>
                                            }
                                        </select>
                                    </div>
                                }
                            </div>
                        </div>
                    </div>
                </div>
                <div class="window-footer window-footer-btn">
                    <div class="col-md-12" style="text-align:right;">
                        <button class="btn btn-primary" type="submit" form="year-form">Generate</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-12">
        <div class="col-xs-12" style="padding:0px;" id="print-div">
            <div class="shadow-wrapper">
                <div class="paper">
                    <div class="row">
                        <div id="test"></div>
                        <!--<canvas id="report-here"></canvas>-->
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="~/Scripts/jquery.unobtrusive-ajax.min.js"></script>

    @Scripts.Render("~/bundles/jqueryval")

    <script>
        var monthNames = ["","January", "February", "March", "April", "May", "June","July", "August", "September", "October", "November", "December"];

        function getSuccessYear() {
            $("#afterReport").html($("#select_annual").val());
        }

        function getSuccessMonth() {
            $("#afterReport").html(monthNames[$("#form_month_month").val()] +" "+ $("#form_month_year").val());
        }

        $("#select-month-year").on("change", function () {
            $("#form_month_year").val($("#select-month-year").val());

            $(".select-month").each(function () {
                if ($(this).attr("data-id") == $("#select-month-year").val()) {
                    $(this).removeClass("collapse");
                    $(this).addClass("in");

                    $("#form_month_month").val($(this).find(".select-month-month").val());
                } else {
                    $(this).removeClass("in");
                    $(this).addClass("collapse");
                }
            });
        });

        $(".select-month-month").on("change", function () {
            $("#form_month_month").val($(this).val());
        });
    </script>
}
