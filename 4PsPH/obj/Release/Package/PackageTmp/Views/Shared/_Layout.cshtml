<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>4P's - @ViewBag.Title</title>
    @Styles.Render("~/Content/css")
    @Scripts.Render("~/bundles/modernizr")

    @RenderSection("styles", required: false)

    <link href="@Url.Content("~/Content/dataTables.bootstrap.min.css")" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Leckerli+One|Nunito" rel="stylesheet">
    <link href="~/Content/font-awesome4.7/css/font-awesome.min.css" rel="stylesheet" />
    <link href="@Url.Content("~/Content/bootstrap-datetimepicker.css")" rel="stylesheet" />
    <link rel="icon" type="image/gif" href="~/Content/images/4Ps_logo.png" />
    <!--<link href="~/Content/jquery-ui.min.css" rel="stylesheet" />-->

    <style>
        .tooltip{
            font-size:0.9em;
        }

        @@media print {
          body * {
            visibility: hidden;
          }
          #print-div, #print-div * {
            visibility: visible;
          }
          #print-div {
            position: absolute !important;
            left: 0 !important;
            top: 0 !important;
          }
        }
    </style>
</head>
<body>
    <div id="wrapper-right">
        <!-- Sidebar -->
        <div id="sidebar-wrapper-right">
            <ul id="sidebar_menu" class="sidebar-nav-right">
                <li class="sidebar-brand-right"><a id="menu-toggle-right" href="#"><font style="color:#7a93b5;">Menu</font> <img width="59" style="padding-top:5px; padding-bottom:5px; float:right; padding-right:15px;" src="~/Content/images/4Ps_logo.png" /></a></li>
            </ul>
            <ul class="sidebar-nav-right" id="sidebar-right">
                <li><a href="@Url.Action("Index","Client")"><font style="font-size:0.9em;">Client</font><span class="sub_icon glyphicon glyphicon-user"></span></a></li>
                <li><a href="@Url.Action("Index","Households")"><font style="font-size:0.9em;">Household</font><span class="sub_icon glyphicon glyphicon-home"></span></a></li>
                <li><a href="@Url.Action("Index","MobileNumbers")"><font style="font-size:0.9em;">Mobile No.</font><span class="sub_icon glyphicon glyphicon-phone"></span></a></li>
                <li><a href="@Url.Action("Index","Tickets")"><font style="font-size:0.9em;">Tickets</font><span class="sub_icon fa fa-ticket" style="padding-right:28px; font-size:1.3em; padding-top:15px;"></span></a></li>
                <li><a href="@Url.Action("Index","FDS")"><font style="font-size:0.9em;">FDS</font><span class="sub_icon fa fa-group" style="padding-right:27px; font-size:1.3em; padding-top:15px;"></span></a></li>
                <li><a href="@Url.Action("Index","Schools")"><font style="font-size:0.9em;">Schools</font><span class="sub_icon fa fa-graduation-cap" style="padding-right:27px; font-size:1.3em; padding-top:15px;"></span></a></li>
                <li><a href="@Url.Action("Index","Hospitals")"><font style="font-size:0.9em;">Hospitals</font><span class="sub_icon fa fa-medkit" style="padding-right:28px; font-size:1.3em; padding-top:15px;"></span></a></li>
                <li><a href="@Url.Action("Index","FDSIssues")" style="position:relative;"><font style="font-size:0.9em;">FDS Issues</font><span class="sub_icon fa fa-group" style="padding-right:27px; font-size:1.3em; padding-top:14px;"></span> <span class="fa fa-exclamation-triangle" style="position:absolute; bottom:10px; right:22px; color:#c35656;"></span></a></li>
                <li><a href="@Url.Action("Index","AttendanceIssues")" style="position:relative;"><font style="font-size:0.9em;">Attendance</font> <span class="sub_icon fa fa-graduation-cap" style="padding-right:27px; font-size:1.3em; padding-top:14px;"></span> <span class="fa fa-exclamation-triangle" style="position:absolute; bottom:15px; right:22px; color:#c35656;"></span></a></li>
                <li><a href="@Url.Action("Index","HealthCheckupIssues")" style="position:relative;"><font style="font-size:0.9em;">Health</font><span class="sub_icon fa fa-medkit" style="padding-right:28px; font-size:1.3em; padding-top:14px;"></span> <span class="fa fa-exclamation-triangle" style="position:absolute; bottom:12px; right:22px; color:#c35656;"></span></a></li>
                <li><a href="@Url.Action("Index","Reports")" style="position:relative;"><font style="font-size:0.9em;">Reports</font><span class="sub_icon fa fa-area-chart" style="padding-right:28px; font-size:1.3em; padding-top:14px;"></span></a></li>
                <li><a href="@Url.Action("Index","Messages")" style="position:relative;"><font style="font-size:0.9em;">Messages</font><span class="sub_icon fa fa-envelope-open" style="padding-right:28px; font-size:1.3em; padding-top:14px;"></span></a></li>

                @if (User.IsInRole("4P's Officer"))
                {
                    <li><a href="@Url.Action("Accounts","Admin")" style="position:relative;"><font style="font-size:0.9em;">Accounts</font><span class="sub_icon fa fa-unlock-alt" style="padding-right:31px; font-size:1.4em; padding-top:14px;"></span></a></li>
                    <li><a href="@Url.Action("Index","Cities")" style="position:relative;"><font style="font-size:0.9em;">Cities</font><span class="sub_icon fa fa-globe" style="padding-right:31px; font-size:1.4em; padding-top:14px;"></span></a></li>
                }
                @*
                    <li style="position:absolute; bottom:0;"><a id="no-hover" style="font-family: 'Sriracha', cursive; font-size:1.5em; line-height:54px;">4P's <img style="width:57px; padding-top:6px; padding-bottom:6px; padding-right:12px; float:right;" src="~/Content/images/4Ps_logo.png" /></a></li>
                *@
                
                @*
                   <li><a data-toggle="collapse" data-target="#clients-nav" href="#">Clients<span class="sub_icon glyphicon glyphicon-menu-down"></span></a>
                    </li>
                    <li class="collapse" id="clients-nav">
                        @Html.ActionLink("Household", "Index", "Households")
                        @Html.ActionLink("Clients", "Index", "Client")
                        @Html.ActionLink("MobileNo", "Index", "MobileNumbers")
                    </li> 
                *@
            </ul>
        </div>

        <!-- Page content -->
        <div id="page-content-wrapper-right">
            <!-- MAIN BODY -->
            <div class="page-content-right inset">
                <div class="navbar navbar-default">
                    <div class="container">
                        <div class="navbar-header">
                            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                                <span class="icon-bar"></span>
                                <span class="icon-bar"></span>
                                <span class="icon-bar"></span>
                            </button>
                            <a class="navbar-brand" href="@Url.Action("Index","Home",null)">4P&nbsp;'s Cloud Solution</a>
                        </div>
                        <div class="navbar-collapse collapse">
                            @*
                                <ul class="nav navbar-nav">
                                    <li class="dropdown">
                                        <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                                            Clients
                                            <span class="caret"></span>
                                        </a>
                                        <ul class="dropdown-menu">
                                            <li>@Html.ActionLink("Household", "Index", "Households")</li>
                                            <li>@Html.ActionLink("Clients", "Index", "Client")</li>
                                            <li>@Html.ActionLink("MobileNumbers", "Index", "MobileNumbers")</li>
                                        </ul>
                                    </li>
                                    <li class="dropdown">
                                        <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                                            Municipal
                                            <span class="caret"></span>
                                        </a>
                                        <ul class="dropdown-menu">
                                            <li>@Html.ActionLink("City", "Index", "Cities")</li>
                                            <li>@Html.ActionLink("School", "Index", "Schools")</li>
                                            <li>@Html.ActionLink("Hospital", "Index", "Hospitals")</li>
                                        </ul>
                                    </li>
                                    <li class="dropdown">
                                        <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                                            FDS
                                            <span class="caret"></span>
                                        </a>
                                        <ul class="dropdown-menu">
                                            <li>@Html.ActionLink("FDS", "Index", "FDS")</li>
                                            <li>@Html.ActionLink("FDS Issues", "Index", "FDSIssues")</li>
                                        </ul>
                                    </li>
                                    <li class="dropdown">
                                        <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                                            Complaints
                                            <span class="caret"></span>
                                        </a>
                                        <ul class="dropdown-menu">
                                            <li>@Html.ActionLink("Attendance Issues", "Index", "AttendanceIssues")</li>
                                            <li>@Html.ActionLink("Health Issues", "Index", "HealthCheckupIssues")</li>
                                            <li>@Html.ActionLink("FDS Issues", "Index", "FDSIssues")</li>
                                            <li>@Html.ActionLink("Ticket", "Index", "Tickets")</li>
                                        </ul>
                                    </li>
                                    <li class="dropdown">
                                        <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                                            Resolutions
                                            <span class="caret"></span>
                                        </a>
                                        <ul class="dropdown-menu">
                                            <li>@Html.ActionLink("Ticket", "Index", "Tickets")</li>
                                            <li>@Html.ActionLink("Resolution", "Index", "Resolutions")</li>
                                            <li>@Html.ActionLink("CaseSummaryReport", "Index", "CaseSummaryReports")</li>
                                            <li>@Html.ActionLink("Endorsement", "Index", "Endorsements")</li>
                                        </ul>
                                    </li>
                                    <li>@Html.ActionLink("Messages", "Index", "Messages")</li>
                                </ul>
                            *@
                            @Html.Partial("_LoginPartial")
                        </div>
                    </div>
                </div>
                <div class="container body-content">
                    @RenderBody()
                </div>
            </div>
        </div>
    </div>

    <div style="position:fixed; bottom:5px; right:10px; color:#7a93b5; font-size:0.8em;">
        <font style="opacity:0;">Jerdine Sabio Yurika Zacarias Alen Malonzo</font> &copy; @DateTime.Now.Year - 4P's Cloud Ver 1.0
    </div>

    @Scripts.Render("~/bundles/jquery")
    @Scripts.Render("~/bundles/bootstrap")

    <script src="~/Scripts/moment.js"></script>
    <script src="~/Scripts/bootstrap-datetimepicker.4.15.js"></script>

    <script src="~/Scripts/datatables.js"></script>
    <script src="~/Scripts/dataTables.bootstrap.js"></script>

    <!--<script src="~/Scripts/jquery-ui.min.js"></script>-->

    <script>
        $("#menu-toggle-right").click(function(e) {
            e.preventDefault();
            $("#wrapper-right").toggleClass("active");
        });
    </script>

    <script src="~/Scripts/jquery.signalR-2.2.2.min.js"></script>
    <script src="~/signalr/hubs"></script>

    <script id="signalR">
        $(function () {
            var feed = $.connection.feedHub;

            feed.client.addmsg = function (msg) {
                //  $("#feed").append("<li>" + msg + "</li>");
                spawnNotification(msg, "4P's notifications.");
            }

            feed.client.grpmsg = function (msg) {
                spawnNotification(msg, "4P's notifications.");
            }

            feed.client.ticketmsg = function (msg) {
                console.log(msg);
                var msgArray = msg.split(",");

                if (msgArray[0] == "Ticket") {
                    var controllerName = "@HttpContext.Current.Request.RequestContext.RouteData.Values["controller"].ToString()";

                    if (controllerName == "Tickets") {
                        var actionName = "@ViewContext.RouteData.GetRequiredString("action")";

                        if (actionName == "Details") {
                            var id = "@ViewContext.RouteData.Values["id"]";

                            console.log(msgArray[1]);

                            if (msgArray[1] == id) {
                                $(".comments_here").prepend("<p class='comment-heading'>"+msgArray[2]+"&emsp; <font>("+msgArray[3]+") "+msgArray[4]+"</font></p><p class='comment-body'>"+msgArray[5]+"</p>");
                            }
                        }
                    }
                }

                //spawnNotification(msg, "Ticket notifications.");
            }

            $.connection.hub.start().done(function () {

            });
        });

        function spawnNotification(theBody, theTitle) {
            var options = {
                body: theBody,
                icon: "@Url.Content("~/Content/images/4Ps_logo.png")"
            }
            var n = new Notification(theTitle, options);
            setTimeout(n.close.bind(n), 4500);
            Play(3, 900);
        }

        Play = (function () {

            var ctx = new (AudioContext || webkitAudioContext);

            return function (duration, freq, finishedCallback) {
                duration = +duration;
                if (typeof finishedCallback != "function") {
                    finishedCallback = function () { };
                }
                var osc = ctx.createOscillator();
                var g = ctx.createGain();
                osc.connect(g);
                g.connect(ctx.destination);
                osc.type = "sine";
                osc.frequency.value = freq;

                if (osc.start) {
                    osc.start();
                    g.gain.exponentialRampToValueAtTime(0.00001, ctx.currentTime + duration);
                }
                else {
                    osc.noteOn(0);
                    g.gain.exponentialRampToValueAtTime(0.00001, ctx.currentTime + duration);
                }
            };
        })();

        /*
        $(document).ready(function () {
            Notification.requestPermission().then(function (result) {
                if (result === "granted") {
                    spawnNotification("Hello there!", "Notification is enabled.");
                }
            });
        });*/

    </script>

    @RenderSection("scripts", required: false)

    <script>
        $(document).ready(function () {
            $('[data-toggle="tooltip"]').tooltip();
        });
    </script>
</body>
</html>
